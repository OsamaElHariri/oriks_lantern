[gd_scene load_steps=11 format=2]

[ext_resource path="res://gameplay/actor/player/player/Player.tscn" type="PackedScene" id=1]
[ext_resource path="res://gameplay/platform/solid_platform/SolidPlatform.tscn" type="PackedScene" id=2]
[ext_resource path="res://gameplay/world/camera/WorldCamera.tscn" type="PackedScene" id=3]
[ext_resource path="res://gameplay/platform/spikes/Spikes.tscn" type="PackedScene" id=4]
[ext_resource path="res://gameplay/platform/moving_platform/MovingPlatform.tscn" type="PackedScene" id=5]
[ext_resource path="res://gameplay/platform/moving_platform/MoveOnTriggerPlatform.tscn" type="PackedScene" id=6]
[ext_resource path="res://icon.png" type="Texture" id=7]
[ext_resource path="res://gameplay/world/temp_level/TextureRect.gd" type="Script" id=8]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform vec2 origin = vec2(0.0, 0.0);

uniform float ring_radius = 0.0;
uniform float ring_thickness = 0.0;

uniform float grey_scale = 0.0;

void fragment() {
	float dist = distance(origin, vec2(FRAGCOORD.x, FRAGCOORD.y));
	
	if (dist != 0.0 && dist < ring_radius + ring_thickness && dist > ring_radius) {
		float diff = dist - ring_radius;
		float distortion = 1.0 - abs(diff) / ring_thickness;
		float radius = dist;
		radius = dist - diff * distortion / 5.0;
		COLOR.rgb = textureLod(SCREEN_TEXTURE, vec2(radius * SCREEN_UV.x / dist, radius * SCREEN_UV.y / dist), 0.0).rgb;
//	} else if (dist < ring_radius) {
////		COLOR.rgb = vec3(dot(textureLod(SCREEN_TEXTURE, SCREEN_UV, 0.0).rgb, vec3(0.299, 0.587, 0.114)));
//		vec3 grey_color = textureLod(SCREEN_TEXTURE, SCREEN_UV, 0.0).rgb;
//		COLOR.rgb = vec3(grey_color.r * 0.75, grey_color.g * 0.75, grey_color.b * 0.8)
	} else {
		COLOR.rgb = textureLod(SCREEN_TEXTURE, SCREEN_UV, 0.0).rgb;
	}
	float rg_multiplier = 1.0 - 0.07 * grey_scale;
	float b_multiplier = 1.0 - 0.04 * grey_scale;
	COLOR.rgb = vec3(COLOR.r * rg_multiplier, COLOR.g * rg_multiplier, COLOR.b * b_multiplier);
}

"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/origin = Vector2( 0, 0 )
shader_param/ring_radius = 0.0
shader_param/ring_thickness = 0.0
shader_param/grey_scale = 0.0

[node name="TempLevel" type="Node2D"]

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="TextureRect" type="TextureRect" parent="CanvasLayer"]
material = SubResource( 2 )
margin_right = 800.0
margin_bottom = 600.0
texture = ExtResource( 7 )
expand = true
script = ExtResource( 8 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="SolidPlatform5" parent="." instance=ExtResource( 2 )]
position = Vector2( 228.652, 751.508 )

[node name="SolidPlatform15" parent="." instance=ExtResource( 2 )]
position = Vector2( 733.642, 123.668 )
rotation = 1.57079

[node name="Spikes" parent="SolidPlatform15" instance=ExtResource( 4 )]
position = Vector2( -144.728, -0.832115 )
rotation = 1.57079
scale = Vector2( 0.0799731, 1 )

[node name="SolidPlatform17" parent="." instance=ExtResource( 2 )]
position = Vector2( 1297.73, 148.383 )
rotation = 1.57079

[node name="SolidPlatform18" parent="." instance=ExtResource( 2 )]
position = Vector2( 1421.74, -1.09579 )

[node name="SolidPlatform19" parent="." instance=ExtResource( 2 )]
position = Vector2( 583.078, 202.928 )

[node name="SolidPlatform16" parent="." instance=ExtResource( 2 )]
position = Vector2( 1013.46, 189.99 )
rotation = 3.14159
scale = Vector2( 1.92, 1 )

[node name="Spikes" parent="SolidPlatform16" instance=ExtResource( 4 )]
position = Vector2( -1.42834, 22.269 )

[node name="SolidPlatform8" parent="." instance=ExtResource( 2 )]
position = Vector2( 29.6645, 257.527 )
rotation = 3.14159

[node name="SolidPlatform9" parent="." instance=ExtResource( 2 )]
position = Vector2( 29.6645, 283.178 )
rotation = 3.14159

[node name="SolidPlatform7" parent="." instance=ExtResource( 2 )]
position = Vector2( 351.591, 596.516 )
rotation = 1.57079

[node name="SolidPlatform13" parent="." instance=ExtResource( 2 )]
position = Vector2( 351.591, 332.552 )
rotation = 1.57079

[node name="SolidPlatform14" parent="." instance=ExtResource( 2 )]
position = Vector2( 351.591, 58.7663 )
rotation = 1.57079

[node name="SolidPlatform11" parent="." instance=ExtResource( 2 )]
position = Vector2( 102.734, 596.516 )
rotation = 1.57079

[node name="SolidPlatform21" parent="." instance=ExtResource( 2 )]
position = Vector2( 102.734, 332.552 )
rotation = 1.57079

[node name="SolidPlatform20" parent="." instance=ExtResource( 2 )]
position = Vector2( 102.734, 58.7663 )
rotation = 1.57079

[node name="SolidPlatform3" parent="." instance=ExtResource( 2 )]
position = Vector2( -248.001, 325.886 )
rotation = 6.28318

[node name="Spikes" parent="SolidPlatform3" instance=ExtResource( 4 )]
position = Vector2( -2.13595, -22.1701 )

[node name="SolidPlatform4" parent="." instance=ExtResource( 2 )]
position = Vector2( -250.214, 362.782 )
rotation = 3.14159

[node name="Spikes" parent="SolidPlatform4" instance=ExtResource( 4 )]
position = Vector2( -1.94565, -21.2729 )

[node name="SolidPlatform10" parent="." instance=ExtResource( 2 )]
position = Vector2( -244.748, 616.017 )
rotation = 3.14159

[node name="Spikes" parent="SolidPlatform10" instance=ExtResource( 4 )]
position = Vector2( 0.259674, -23.4598 )

[node name="Player" parent="." instance=ExtResource( 1 )]
position = Vector2( 241.83, 704.336 )

[node name="WorldCamera" parent="." instance=ExtResource( 3 )]
position = Vector2( 512, 300 )
current = true

[node name="MovingPlatforms" type="Node2D" parent="."]
position = Vector2( -548.866, 264.837 )

[node name="MovingPlatform3" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632629, 638.978 )

[node name="MovingPlatform4" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632568, 424.272 )

[node name="MovingPlatform8" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632568, -23.1224 )

[node name="MovingPlatform7" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632568, 185.34 )

[node name="MovingPlatform6" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632568, -248.665 )

[node name="MovingPlatform5" parent="MovingPlatforms" instance=ExtResource( 5 )]
position = Vector2( 0.632568, -509.882 )

[node name="MoveOnTriggerPlatform" parent="." instance=ExtResource( 6 )]
position = Vector2( 221.089, -55.2206 )
speed = 1000
ramp_up_speed = 200
